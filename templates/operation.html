<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>出入库操作</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link href="/static/css/style.css?v=1.1" rel="stylesheet" />
  </head>
  <body>
    <div class="container">
      <h1 class="mt-4">出入库操作</h1>
      <nav class="nav nav-pills">
        <a class="nav-link" href="{{ url_for('index') }}">库存概览</a>
        <a class="nav-link" href="{{ url_for('add_device') }}">添加设备</a>
        <a class="nav-link" href="{{ url_for('operation') }}">出入库</a>
        <a class="nav-link" href="{{ url_for('history') }}">操作历史</a>
      </nav>
      <div class="card mt-4">
        <div class="card-body">
          <h2 class="card-title">执行出入库操作</h2>
          <form id="operationForm" class="mt-3">
            <div class="mb-3">
              <label for="device_id" class="form-label">选择设备</label>
              <select
                class="form-control"
                id="device_id"
                name="device_id"
                required
              >
                {% for device in devices %}
                <option value="{{ device[0] }}">{{ device[1] }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="mb-3">
              <label for="operation" class="form-label">操作类型</label>
              <select
                class="form-control"
                id="operation"
                name="operation"
                required
              >
                <option value="in">入库</option>
                <option value="out">出库</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="quantity" class="form-label">数量</label>
              <input
                type="number"
                class="form-control"
                id="quantity"
                name="quantity"
                required
                min="1"
              />
            </div>
            <div class="mb-3">
              <label for="operator" class="form-label">操作人</label>
              <select
                class="form-control"
                id="operator"
                name="operator"
                required
              >
                <option value="雒家俊" selected>雒家俊</option>
                <option value="杨昊罡">杨昊罡</option>
                <option value="刘九龙">刘九龙</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="source_destination" class="form-label"
                >来源或去处</label
              >
              <input
                type="text"
                class="form-control"
                id="source_destination"
                name="source_destination"
                required
              />
            </div>
            <button type="submit" class="btn btn-primary">提交</button>
          </form>
          <div id="message" class="mt-3"></div>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        $("#operationForm").on("submit", function (e) {
          e.preventDefault();
          $.ajax({
            url: "/api/operation",
            type: "POST",
            data: $(this).serialize(),
            success: function (response) {
              $("#message")
                .text(response.message)
                .removeClass("text-danger")
                .addClass("text-success");
              // 动态更新库存（需实现后端 API 或前端逻辑）
              alert("操作成功，请返回库存概览查看更新！");
            },
            error: function (xhr) {
              $("#message")
                .text(xhr.responseJSON.message)
                .removeClass("text-success")
                .addClass("text-danger");
            },
          });
        });
      });
    </script>
  </body>
</html>
